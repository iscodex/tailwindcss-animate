---
import { animates } from "../consts/animate";
import { cn } from "../lib/cn";

function isActiveAnimation(anim: string): boolean {
  const url = new URL(Astro.request.url);
  const animation = url.searchParams.get("animation") || "animate-bounce";

  return animation === anim;
}
---

<div class="relative w-80">
  <div class="absolute inset-0">
    <aside
      class="bg-slate-900/50 border-r border-slate-800 sticky top-0 overflow-y-auto h-full max-h-dvh"
    >
      <div class="py-6">
        <div class="mb-8 px-6">
          <h1 class="text-slate-200 font-semibold text-lg mb-2">Animations</h1>
          <p class="text-slate-400 text-sm">Select an animation to explore</p>
        </div>
        <div class="space-y-4 px-2">
          {
            animates.map((group) => {
              return (
                <div class="space-y-2">
                  <div class="px-4">
                    <h2 class="font-semibold text-slate-400">{group.name}</h2>
                  </div>

                  {group.children.map((anim) => {
                    const isActive = isActiveAnimation(anim.class);

                    return (
                      <button
                        data-anim={anim.class}
                        data-anim-active={isActive}
                        class={cn(
                          "rounded-lg p-4 cursor-pointer transition-all flex items-center space-x-3 w-full",
                          isActive
                            ? "bg-slate-800 border border-slate-700 shadow-lg"
                            : "border border-transparent hover:bg-slate-800/50 hover:border-slate-700/50"
                        )}
                      >
                        <div
                          class={cn(
                            "w-8 h-8 rounded-lg flex items-center justify-center transition-colors",
                            isActive ? "bg-slate-600 border border-slate-500" : "bg-slate-700"
                          )}
                        />

                        <div class="flex-1 text-start">
                          <span class="font-medium text-slate-200">{anim.name}</span>
                        </div>

                        {isActive && (
                          <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse" />
                        )}
                      </button>
                    );
                  })}
                </div>
              );
            })
          }
        </div>
      </div>
    </aside>
  </div>
</div>

<script>
  document.addEventListener("astro:page-load", () => {
    const params = new URLSearchParams(document.location.search);

    const links = document.querySelectorAll("[data-anim]");

    links.forEach((link) => {
      link.addEventListener("click", () => {
        // const anim = link.dataset.anim;
        // params.set("animation", anim);
        // window.history.replaceState({}, "", `${location.pathname}?${params}`);
      });
    });

    // const link = document.querySelector("[data-anim-active=true]");
    // if (link) {
    //   link.scrollIntoView({
    //     behavior: "smooth",
    //     block: "center",
    //   });
    // }
  });
</script>
